---
import Card from "../../../components/Card.astro";
import BaseLayout from "../../../layouts/BaseLayout.astro";

export function getStaticPaths() {
  const allPosts = [
    {
      title: "Getting Started with Astro",
      description: "Learn the basics of the Astro framework.",
      slug: "getting-started",
      date: "2026-01-15",
      tags: ["astro", "getting-started"],
    },
    {
      title: "Understanding Islands Architecture",
      description: "Why partial hydration changes everything.",
      slug: "islands-architecture",
      date: "2026-01-16",
      tags: ["astro", "islands-architecture"],
    },
    {
      title: "Content Collections Deep Dive",
      description: "Type-safe content management in Astro.",
      slug: "content-collections",
      date: "2026-01-17",
      tags: ["astro", "content-collections"],
    },
  ];

  // Get unique tags
  const uniqueTags = [...new Set(allPosts.flatMap((post) => post.tags))];

  // Return one page per tag with all posts for that tag
  return uniqueTags.map((tag) => ({
    params: { tag },
    props: {
      posts: allPosts.filter((post) => post.tags.includes(tag)),
    },
  }));
}

const { posts } = Astro.props;
const { tag } = Astro.params;
---

<BaseLayout
  title={`Tag: "${tag}"`}
  description={`Read all posts tagged with "${tag}".`}>
  <h1 class="font-serif text-4xl lg:text-5xl text-(--color-text) mb-4">
    Posts tagged with "{tag}"
  </h1>
  <p class="text-xl text-(--color-text-muted) mb-12">
    Found {posts.length} post{posts.length !== 1 ? "s" : ""} with this tag.
  </p>

  <div class="space-y-8 mb-12">
    {
      posts.map((post) => (
        <Card
          date={post.date}
          title={post.title}
          description={post.description}
          url={`/blog/${post.slug}`}
        />
      ))
    }
  </div>

  <a
    href="/blog"
    class="text-(--color-accent) hover:text-(--color-accent-hover) no-underline font-medium"
    >‚Üê Back to all posts</a
  >
</BaseLayout>
